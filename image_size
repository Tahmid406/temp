import os
from PIL import Image

def find_images_with_size(folder_path, target_width, target_height):
    """
    Find images in the specified folder that match the target dimensions
    
    Parameters:
    folder_path (str): Path to folder containing images
    target_width (int): Target image width
    target_height (int): Target image height
    
    Returns:
    list: List of image filenames with specified dimensions
    """
    matched_images = []
    
    # Check if the folder exists
    if not os.path.exists(folder_path) or not os.path.isdir(folder_path):
        print(f"Error: The folder {folder_path} does not exist or is not a directory.")
        return matched_images
    
    # List all files in the directory
    for filename in os.listdir(folder_path):
        file_path = os.path.join(folder_path, filename)
        
        # Check if it's a file
        if os.path.isfile(file_path):
            try:
                # Try to open the file as an image
                with Image.open(file_path) as img:
                    width, height = img.size
                    
                    # Check if image has the target size
                    if width == target_width and height == target_height:
                        matched_images.append(filename)
                        print(f"Found matching image: {filename} - Size: {width}x{height}")
            except Exception as e:
                # Skip files that aren't valid images
                continue
    
    # Print summary
    if matched_images:
        print(f"\nFound {len(matched_images)} images with size {target_width}x{target_height}")
    else:
        print(f"\nNo images with size {target_width}x{target_height} found")
    
    return matched_images

# Set the target folder and dimensions
folder_path = r"D:\Tahmid\Data\Test\fold_4\masks"
target_width = 512
target_height = 517

# Find and print the matching images
matching_images = find_images_with_size(folder_path, target_width, target_height)

# You can also save the list to a text file if needed
if matching_images:
    output_file = os.path.join(os.path.dirname(folder_path), "matching_images.txt")
    with open(output_file, "w") as f:
        for img in matching_images:
            f.write(f"{img}\n")
    print(f"List of matching images saved to {output_file}")
